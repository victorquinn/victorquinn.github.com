
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>PHP Inheritance - Ensure method in parent returns instance of child - Victor Quinn</title>
  <meta name="author" content="Victor Quinn">

  
  <meta name="description" content="I recently came up against a pretty interesting problem in PHP. Explaining the
problem will take up the majority of this post, the solution the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://victorquinn.com/blog/2013/01/09/php-inheritance-ensure-method-in-parent-returns-instance-of-child/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Victor Quinn" type="application/atom+xml">
  <!--Custom Javascript -->
<script src="/javascripts/jquery-1.7.1.min.js"></script>
<script type="text/javascript">
  jQuery.noConflict();
</script>
<script src="/javascripts/victorquinn.js"></script>

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=Mate+SC:400,400italic,700,700italic,900,900italic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Carrois+Gothic+SC" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Playball" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Lustria" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Molengo" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-29142694-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <a id="top"></a>
  <h1><a href="/">Victor Quinn</a></h1>
  
    <h2>Software Engineer, Legal Scholar, Problem Solver.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<ul class="main-navigation">
  <li><a class="menu menu1" href="/blog/categories/tutorial/">Tutorials</a></li>
  <li><a class="menu menu2" href="/development">Development</a></li>
  <li><a class="menu menu3" href="/blog/archives/">Archives</a>
  <li><a class="menu menu4" href="/legal">Legal</a></li>
  <li><a class="menu menu5" href="/files/VQResumeLatest.pdf">Résumé</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">PHP Inheritance - Ensure Method in Parent Returns Instance of Child</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-09T11:55:00-05:00" pubdate data-updated="true">Jan 9<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I recently came up against a pretty interesting problem in PHP. Explaining the
problem will take up the majority of this post, the solution the minority.</p>

<p>If the title gives you enough info to know this is likely the solution to your
problem, <a href="#inheritance-solutions">click here to jump to the solutions.</a></p>

<h2>The Problem</h2>

<p>On a recent application I was building in PHP, I had a parent class with
children that inherited from it and overrode some methods of the parent.</p>

<p>I was building a queryable object, the idea of which was that I could chain
together query methods which could each pass through and filter the returned
dataset.</p>

<p>Problem being, in the parent I was returning instances of the parent class, so
if I chained 2 of these together, a method called on the second call would call
the parent&#8217;s method, not the child&#8217;s method (if it had overwritten the parent
method).</p>

<p>To make this a bit more concrete, I have concocted an example which is a
simplified version of the problem I needed to solve:</p>

<h2>Example</h2>

<h3>The parent class</h3>

<p>First, we have a filterable object class with some base methods:</p>

<figure class='code'><figcaption><span>Parent Class  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Filterable</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">protected</span> <span class="nv">$items</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">items</span> <span class="o">=</span> <span class="nv">$i</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Limit how many items are returned</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param $n</span>
</span><span class='line'><span class="sd">     *   The number of items to return</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">function</span> <span class="nf">limit</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nx">Filterable</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$n</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Skip the first N items</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param $n</span>
</span><span class='line'><span class="sd">     *   The number of items to skip</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">function</span> <span class="nf">skip</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nx">Filterable</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(),</span> <span class="nv">$n</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Return the $items as an array</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">function</span> <span class="nf">get</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">items</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So as you can see, a pretty simple class. It takes in an array of items and then
has methods to limit() or skip() a number of items in that list and a method to
get the resultant array back.</p>

<h3>Using the Parent Class</h3>

<p>To use this is pretty simple:</p>

<figure class='code'><figcaption><span>Using the Parent Class  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nv">$items</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Instantiate a new instance of Filterable</span>
</span><span class='line'><span class="nv">$filterable</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Filterable</span><span class="p">(</span><span class="nv">$items</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Now do some filtering</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Returns an object of type Filterable with the internal array</span>
</span><span class='line'><span class="c1">// of array(1, 2, 3, 4)</span>
</span><span class='line'><span class="nv">$filterable</span><span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// But we can also chain them</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Returns an object of type Filterable with the internal array of</span>
</span><span class='line'><span class="c1">// array(2, 3, 4)</span>
</span><span class='line'><span class="nv">$filterable</span><span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// To get the resulting array, we can use the get() function to pull out the</span>
</span><span class='line'><span class="c1">// internal data. So the following returns the actual array</span>
</span><span class='line'><span class="nv">$filterable</span><span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>So this is all well and good and works like a charm. Go ahead, try it, it&#8217;ll
work as expected. So where does the problem arise?</p>

<h3>Enter a child</h3>

<p>So let&#8217;s add a child class and override one of the methods. Let&#8217;s say we want to
alter the limit() function so it limits by n*2 elements if n is passed to it. It
will inherit all of the attributes of the parent so there is no need to
redeclare any methods we are not overriding here. So __construct(), skip(), and
get() will work by using the parent&#8217;s methods.</p>

<figure class='code'><figcaption><span>Child Class  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">FilterableChild</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Skip the first N*2 elements</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param $n</span>
</span><span class='line'><span class="sd">     *   Doubled, this is the number of items to skip</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">function</span> <span class="nf">skip</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nx">FilterableChild</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(),</span> <span class="nv">$n</span><span class="o">*</span><span class="mi">2</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Using this child</h3>

<p>Let&#8217;s try using the child class:</p>

<figure class='code'><figcaption><span>Using the Child Class  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nv">$items</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Instantiate a new instance of FilterableChild</span>
</span><span class='line'><span class="nv">$filterable</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FilterableChild</span><span class="p">(</span><span class="nv">$items</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Now do some filtering</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Returns an object of type Filterable (note: not FilterableChild) with the</span>
</span><span class='line'><span class="c1">// internal array (1, 2, 3, 4)</span>
</span><span class='line'><span class="nv">$filterable</span><span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Returns an object of type FilterableChild with the internal array (3, 4, 5)</span>
</span><span class='line'><span class="c1">// as it as skipped the first n*2 elements as defined in the child class</span>
</span><span class='line'><span class="nv">$filterable</span><span class="o">-&gt;</span><span class="na">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// But we can also chain them</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Returns an object of type Filterable with the internal array of (2, 3, 4),</span>
</span><span class='line'><span class="c1">// not (3, 4) as would be expected.</span>
</span><span class='line'><span class="nv">$filterable</span><span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Uh oh, but that&#8217;s not what we wanted. We started off with a FilterableChild
object so we&#8217;d like to call the FilterableChild object&#8217;s skip method, but we are
calling the parent&#8217;s skip method here because limit() returned an object of type
Filterable, not FilterableChild, so when skip() is called, the parent object&#8217;s
method is called rather than the child&#8217;s.</p>

<p>But how to solve this? We surely do not want to update the parent to have
knowledge of the child, that breaks some of the Object Oriented nature of the
code.</p>

<p>In an ideal world we would do some kind of object introspection so the parent
class would return an object of whatever type was passed to it, but PHP doesn&#8217;t
really have true introspection so this will not work either!</p>

<p>We could use the factory pattern, but then we&#8217;d be creating a bunch of
extraneous classes.</p>

<h2><a id="inheritance-solutions"></a> The Solutions</h2>

<p>I actually came up with 2 solutions to this problem, one before and another
while writing this article.</p>

<h3>First solution: Messy introspection</h3>

<p>We could use something like the following for each of our parent methods:</p>

<figure class='code'><figcaption><span>Using the Child Class  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Filterable</span> <span class="p">{</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Skip the first N items</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param $n</span>
</span><span class='line'><span class="sd">     *   The number of items to skip</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">function</span> <span class="nf">skip</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$myClass</span> <span class="o">=</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nv">$myClass</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(),</span> <span class="nv">$n</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This uses some kind of messy PHP introspection. There is no true object
introspection in PHP, so the best we can do is use the get_class() method which
returns a string which is the name of the class and then use that class to
return an object of the type of $this.</p>

<p>This would obviously work for the parent, but the magic is that it also works
for the child as even if the child does not implement a method (thereby falling
back to the parent&#8217;s implementation) the parent will return an object of the
child&#8217;s type. In other words, since $this for a child object would be
FilterableChild, even if the parent&#8217;s skip() method is called, get_class($this);
would return &#8220;FilterableChild&#8221; so the parent, which has no knowledge of the
child is able to return an object of that child&#8217;s class.</p>

<p>This could also be refactored to its own member function and called from within
any member methods to be a bit cleaner:</p>

<figure class='code'><figcaption><span>Using the Child Class  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Filterable</span> <span class="p">{</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Skip the first N items</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param $n</span>
</span><span class='line'><span class="sd">     *   The number of items to skip</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">function</span> <span class="nf">skip</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">construct_instance_of</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(),</span> <span class="nv">$n</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Construct an instance matching the original class</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">function</span> <span class="nf">construct_instance_of</span><span class="p">(</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$class</span> <span class="o">=</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$class</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is appealing because the child class doesn&#8217;t need to do any additional work
and it will work.</p>

<h3>Second Solution: Implement construct_instance_of() in child</h3>

<p>This solution is perhaps a bit cleaner because it doesn&#8217;t deal with the ugliness
of getting the class name as a string and deaing with it, but requires any child
objects to override the construct_instance_of() method to return an object of
its type. Below I&#8217;ve got code for the parent and child object to make this work:</p>

<figure class='code'><figcaption><span>Parent  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Filterable</span> <span class="p">{</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Skip the first N items</span>
</span><span class='line'><span class="sd">     *</span>
</span><span class='line'><span class="sd">     * @param $n</span>
</span><span class='line'><span class="sd">     *   The number of items to skip</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">function</span> <span class="nf">skip</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">construct_instance_of</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(),</span> <span class="nv">$n</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Construct an instance matching the original class</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">function</span> <span class="nf">construct_instance_of</span><span class="p">(</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nx">Filterable</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Child  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">FilterableChild</span> <span class="p">{</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'>
</span><span class='line'>    <span class="sd">/**</span>
</span><span class='line'><span class="sd">     * Construct an instance matching the original class</span>
</span><span class='line'><span class="sd">     */</span>
</span><span class='line'>    <span class="k">function</span> <span class="nf">construct_instance_of</span><span class="p">(</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nx">FilterableChild</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="o">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since an object is created with its class, if we are always using
construct_instance_of() to return the object and it&#8217;s implemented in all
children, the returned object will always have the child class even if the
method is called from the parent.</p>
<a rel="permalink" class="permalink" href="">∮</a></div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Victor Quinn</span></span>

      








  


<time datetime="2013-01-09T11:55:00-05:00" pubdate data-updated="true">Jan 9<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/development/'>Development</a>, <a class='category' href='/blog/categories/drupal/'>Drupal</a>, <a class='category' href='/blog/categories/php/'>PHP</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://victorquinn.com/blog/2013/01/09/php-inheritance-ensure-method-in-parent-returns-instance-of-child/" data-via="victorquinn" data-counturl="http://victorquinn.com/blog/2013/01/09/php-inheritance-ensure-method-in-parent-returns-instance-of-child/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/01/06/moving/" title="Previous Post: Moving">&laquo; Moving</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section id="about-me">
  <div class="author-image"><img src="http://victorquinn.com/images/VictorQuinn%20100x100.jpg"></div>
  <div class="author">
    <span class="author-name">Victor Quinn</span>
    <br />
    <span class="author-email"><a href='mailto&#58;%6Da&#105;&#108;%&#52;&#48;&#118;%&#54;9c%74%6&#70;%&#55;&#50;&#113;uinn&#46;&#99;o&#109;'>ma&#105;l&#64;v&#105;ctorquinn&#46;com</a></span>
    <span class="author-twitter"><a href="https://twitter.com/#!/victorquinn">@victorquinn</a></span>
  </div>
  <h1>About Me</h1>
  <p>I grew up in Rochester, NY. My early career aspirations included nearly anything imaginable at one point or another, but I always gravitated toward the realms of science and logic.</p>
  <p>Upon graduating from high school, I ventured to Massachusetts where I spent the next 10 years of my life becoming educated in Computer Science, Physics, and the Law.</p>
  <p>In parallel, I spent most of those years working as a professional software engineer in the field of education, first at <a href="http://www.umass.edu" target=_blank>UMass Amherst</a> and then at <a href="https://www.amherst.edu" target=_blank>Amherst College.</a>
  <p>After graduating from Law School, I moved down to Northern Virginia in search of warmer weather and a chance to enjoy life in a different region of the country. I also used this opportunity to change pace in my day-to-day, now working for <a href="http://www.ngpvan.com" target=_blank>NGP VAN</a>, a company specializing in political software. I am truly enjoying bringing my experience developing for the education sector while at the same time learning about the entirely different realm of politics.</p>
  <p>On the side I am working on building my new legal learning startup, <a href="http://scalesapp.com">Scales</a>. I am also constantly expanding my knowledge of programming and the law while living with both my wife Susan and our great dane Stella.</p>
  <p>Life is excellent and if you think otherwise, you're doing it wrong.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/01/09/php-inheritance-ensure-method-in-parent-returns-instance-of-child/">PHP Inheritance - Ensure method in parent returns instance of child</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/06/moving/">Moving</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/23/cloud9/">Cloud9</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/25/launching-scales/">Announcing Scales</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/01/fresh-look/">Fresh look</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/victorquinn">@victorquinn</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'victorquinn',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("victorquinn", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/victorquinn" class="twitter-follow-button" data-show-count="false">Follow @victorquinn</a>
  
</section>





<section>
  <h1>Coderwall</h1>
  <ul id="cw_badges">
    <li class="loading">Status updating...</li>
  </ul>

  <script type="text/javascript">
    var coderwall = (function(){
      function render(options, badges){
        var fragment = '',
            t = $(options.target),
            height = 65,
            width = 65,
            index;

        for (index in badges) {
          fragment += '<a class="cw_badge"title="' + badges[index].description + '" href="http://coderwall.com/' + options.user + '">';
          fragment +=   '<img alt="' + badges[index].description + '" height="' + width + '" width="' + height + '" src="' + badges[index].badge + '"/>';
          fragment += '</a>';
        }

        t.html(fragment);
      }
      return {
        showBadges: function(options){
          console.log(options);
          $.ajax({
              url: 'http://coderwall.com/' + options.user + '.json?callback=?'
            , dataType: 'jsonp'
            , error: function (err) { $(options.target + ' li.loading').addClass('error').text("Error loading feed"); }
            , success: function(res) {
                render(options, res.data.badges);
            }
          });
        }
      };
    })();

    $(document).ready(function(){
      coderwall.showBadges({
        user: 'victorquinn',
        target: '#cw_badges'
      });
    });
  </script>
  <style type="text/css">
    .cw_badge img {
      padding: 5px;
      border: 0 none !important;
      -moz-box-shadow: none !important;
      -webkit-box-shadow: none !important;
      -o-box-shadow: none !important;
      box-shadow: none !important;
    }
  </style>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Victor Quinn -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
